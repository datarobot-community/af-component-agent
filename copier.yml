# questions
agent_app_name:
  type: str
  default: "agent"
  help: "The name/folder of your Agent Deployment. Must be a Python-friendly name (letters, numbers, underscores only, no spaces)"
  validator: >-
    {% if not agent_app_name %}ERROR: Agent app name cannot be empty
    {% elif ' ' in agent_app_name %}ERROR: Agent app name cannot contain spaces
    {% elif not agent_app_name.isidentifier() %}ERROR: Agent app name must be a valid Python identifier (letters, numbers, underscores only, cannot start with number)
    {% endif %}

use_low_code_interface:
  type: bool
  help: "Do you want to use low-code YAML-based configuration (i.e. NeMo Agent Toolkit) for your agent? (default: no)"
  default: no

agent_template_framework:
  type: str
  default: |-
    {% if use_low_code_interface -%}
      nat
    {%- else -%}
      base
    {%- endif %}
  help: "Choose the agentic framework template to start with:"
  choices:
    Base: base
    CrewAI: crewai
    LangGraph: langgraph
    LlamaIndex: llamaindex
    "NeMo Agent Toolkit (NAT)": nat
  when: "{{not use_low_code_interface}}"

base_answers_file:
  type: str
  default: ".datarobot/answers/base.yml"
  help: "Path to the base component answers file (must contain '.datarobot/answers')"
  validator: >-
    {% if not base_answers_file %}ERROR: Base answers file path cannot be empty
    {% elif '.datarobot/answers' not in base_answers_file %}ERROR: Base answers file must contain '.datarobot/answers' in the path
    {% endif %}

llm_answers_file:
  type: str
  default: ".datarobot/answers/llm-llm.yml"
  help: "Path to the llm component answers file (must contain '.datarobot/answers')"
  validator: >-
    {% if not llm_answers_file %}ERROR: LLM answers file path cannot be empty
    {% elif '.datarobot/answers' not in llm_answers_file %}ERROR: LLM answers file must contain '.datarobot/answers' in the path
    {% endif %}

mcp_answers_file:
  type: str
  default: ".datarobot/answers/drmcp-mcp_server.yml"
  help: "Path to the DataRobot MCP component answers file (must contain '.datarobot/answers')"
  validator: >-
    {% if not mcp_answers_file %}ERROR: DataRobot MCP answers file path cannot be empty
    {% elif '.datarobot/answers' not in mcp_answers_file %}ERROR: DataRobot MCP answers file must contain '.datarobot/answers' in the path
    {% endif %}

# Grab the base component answers to re-use answers
# WARNING: This MCP dependency is necessary because if a user has an agent and an MCP. They will need to know about each other.
# BUT do not use the variables from this external dependency in a way that makes the dependency a hard requirements.
# BECAUSE the agent MUST still be able to run without the MCP.
_external_data:
  base: "{{ base_answers_file }}"
  llm: "{{ llm_answers_file }}"
  mcp: "{{ mcp_answers_file }}"

_subdirectory: template
_answers_file: ".datarobot/answers/agent-{{ agent_app_name }}.yml"
_exclude:
    - "*.j2"

_migrations:
  - command:
      - bash
      - -lc
      - >
        if [ -f "{{ agent_app_name }}/agentic_workflow/agent.py" ]; then
          mkdir -p "{{ agent_app_name }}/agent";
          mv "{{ agent_app_name }}/agentic_workflow/agent.py" \
             "{{ agent_app_name }}/agent/myagent.py";
        fi
    when: "{{ _stage == 'before'}}"