---
# https://taskfile.dev
version: '3'
env:
  ENV: testing
dotenv: ['.env', {% raw %}'.env.{{.ENV}}'{% endraw %}]
includes:
  # Source the agent Taskfile
  agent:
    taskfile: ./{{ agent_app_name }}/Taskfile.yml
    dir: ./{{ agent_app_name }}
  {% if include_taskfile_infra -%}
  # Source the infra Taskfile as flat tasks and point at the infra directory
  infra:
    # REMOVE YOUR INFRASTRUCTURE TASKFILE IF PRESENT
    # rm ./infra/Taskfile.yml
    taskfile: ./{{ agent_app_name }}/Taskfile_infra.yml
    dir: ./infra{% endif %}
tasks:
  default:
    desc: "‚ÑπÔ∏è Show all available tasks (run `task --list-all` to see hidden tasks)"
    cmds:
      - task --list --sort none
    silent: true
  install:
    desc: "üõ†Ô∏è Install all dependencies for agent and infra"
    cmds:
      - task: agent:install
      {% if include_taskfile_infra -%}- task: infra:install{% endif %}
    silent: true
  agents-md:
    desc: "ü§ñ Generate/update AGENTS.md via DataRobot LLM (use -- {% raw %}--dir=<subdir> --dry-run{% endraw %})"
    dotenv: [".env"]
    cmds:
      - uv run scripts/generate_agents_md.py {% raw %}{{.CLI_ARGS}}{% endraw %}
  {% if include_taskfile_infra -%}build:
    cmds:
      - task: infra:build
  deploy:
    cmds:
      - task: infra:deploy
  destroy:
    cmds:
      - task: infra:destroy{% endif %}
