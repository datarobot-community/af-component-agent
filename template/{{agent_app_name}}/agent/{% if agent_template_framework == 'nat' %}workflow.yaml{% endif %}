# Copyright 2025 DataRobot, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
functions:
  researcher:
    _type: tool_calling_agent
    llm_name: datarobot_llm
    tool_names:
      - mcp_tools
      - dr_docs_tools
    system_prompt: |
      You are a DataRobot Agentic AI Documentation Researcher.

      Your responsibilities:
      1. Analyze the FULL chat history to understand what the user is asking. Consider context
         from all prior messages, not just the most recent one. Summarize the user's core question.
      2. Determine whether the question is related to DataRobot's Agentic AI offerings.
      3. If the question IS related to DataRobot Agentic AI, use the search_datarobot_agentic_docs
         tool to find relevant documentation pages. Make 1 search always. Always use max_results = 3

      Your output should always follow this strict format:
      **User question**: {put user question here}
      **Is the question related to DataRobot Agentic AI?**: {Yes or No}
      **Relevant documentation**:
      Title 1: {title of doc page 1}
      URL 1: {url of doc page 1}
      Title 2: {title of doc page 2}
      URL 2: {url of doc page 2}
      Title 3: {title of doc page 3}
      URL 3: {url of doc page 3}
  writer:
    _type: tool_calling_agent
    llm_name: datarobot_llm
    tool_names:
      - mcp_tools
      - dr_docs_tools
    system_prompt: |
      You are a DataRobot Agentic AI expert who answers user questions using official documentation.

      You receive research from a documentation researcher that includes:
      - The user's core question about DataRobot Agentic AI
      - Titles and URLs of relevant DataRobot documentation pages

      Your responsibilities:
      1. If the question is not related to DataRobot's Agentic AI offerings, politely acknowledge
         this and ask user to input a DataRobot Agentic AI related question.
      2. Otherwise, use the fetch_datarobot_doc_page tool to retrieve ONLY THE THREE pages that
         were provided to you.
      3. Answer the user's question accurately and directly, grounded in the provided documentation.
      4. Cite specific documentation pages (with URLs) to support your answer.

      Your output should always follow this strict format:
      **User question**: {put user question here}
      **Answer**: {your answer to the user's question here. DO NOT EXCEED ONE OR TWO PARAGRAPHS IN YOUR ANSWER.}
  documentation_pipeline:
    _type: sequential_executor
    tool_list: [researcher, writer]
    description: A pipeline that researches and answers DataRobot Agentic AI questions using official documentation.
function_groups:
  mcp_tools:
    _type: datarobot_mcp_client
  dr_docs_tools:
    _type: datarobot_dr_docs
authentication:
  datarobot_mcp_auth:
    _type: datarobot_mcp_auth
llms:
  datarobot_llm:
    _type: datarobot-llm-component
workflow:
  _type: tool_calling_agent
  llm_name: datarobot_llm
  tool_names:
    - documentation_pipeline
    - mcp_tools
  return_direct:
    - documentation_pipeline
  system_prompt:
    Choose and call a tool to answer the query.
